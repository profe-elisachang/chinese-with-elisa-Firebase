# 🔍 Netlify 使用量異常診斷指南

## 🚨 問題描述
網站前天才部署，但已經超過 Netlify 免費額度（300 信用額度）。這很不正常！

---

## 🔍 可能的原因（按可能性排序）

### 1. ⚠️ 頻繁的 Git 提交觸發構建（最可能）

**問題：**
- 每次 `git push` 都會觸發 Netlify 構建
- 如果這兩天有很多次提交，就會快速消耗構建時間

**檢查方法：**
1. 在 Netlify Dashboard 查看構建歷史
2. 數一下這兩天有多少次構建
3. 查看 Git 提交歷史：
   ```bash
   git log --since="2 days ago" --oneline
   ```

**解決方案：**
- ✅ 只構建主分支（main/master）
- ✅ 使用構建鉤子手動部署
- ✅ 忽略不重要的文件變更（如 `*.md`）

---

### 2. ⚠️ 構建時間過長

**問題：**
- 每次構建需要很長時間（如 10-20 分鐘）
- 即使只有幾次構建，也會快速消耗配額

**檢查方法：**
1. 在 Netlify Dashboard 查看構建日誌
2. 查看每次構建花了多長時間
3. 免費額度：每月 300 分鐘
   - 如果每次構建 10 分鐘 = 只能構建 30 次
   - 如果每次構建 20 分鐘 = 只能構建 15 次

**解決方案：**
- ✅ 優化構建配置（已創建 `netlify.toml`）
- ✅ 這是靜態網站，不需要構建命令
- ✅ 減少構建步驟

---

### 3. ⚠️ 構建循環（Build Loop）

**問題：**
- 構建過程中可能觸發了新的構建
- 例如：構建腳本修改了文件，觸發新的構建

**檢查方法：**
1. 查看構建日誌，看是否有異常的構建觸發
2. 檢查是否有構建腳本會修改文件
3. 查看構建時間線，看是否有連續的構建

**解決方案：**
- ✅ 確保構建命令不會修改源文件
- ✅ 檢查 `.gitignore` 是否正確
- ✅ 禁用自動構建，使用手動觸發

---

### 4. ⚠️ 團隊中其他項目也在使用配額

**問題：**
- 如果是團隊帳號 `profe-EYY`，其他項目也在使用配額
- 配額是團隊共享的，不是按項目分配

**檢查方法：**
1. 在 Netlify Dashboard 查看團隊使用量
2. 查看所有項目的構建歷史
3. 確認是否有其他項目也在頻繁構建

**解決方案：**
- ✅ 檢查團隊中所有項目的使用情況
- ✅ 優化所有項目的構建配置
- ✅ 考慮為不同項目使用不同的 Netlify 帳號

---

### 5. ⚠️ 帶寬使用過多

**問題：**
- 網站訪問量大
- 大文件（圖片、音頻）未優化
- 免費額度：每月 100GB

**檢查方法：**
1. 在 Netlify Dashboard 查看帶寬使用量
2. 查看訪問統計
3. 檢查文件大小

**解決方案：**
- ✅ 啟用緩存（已在 `netlify.toml` 中配置）
- ✅ 優化圖片大小
- ✅ 使用 CDN

---

### 6. ⚠️ 配置錯誤導致重複構建

**問題：**
- 構建配置錯誤
- 可能配置了不必要的構建步驟

**檢查方法：**
1. 檢查 Netlify 構建設置
2. 查看 `netlify.toml` 配置
3. 確認構建命令是否正確

**解決方案：**
- ✅ 使用已優化的 `netlify.toml`
- ✅ 確保構建命令為空（靜態網站不需要構建）

---

## 📊 立即檢查步驟

### 步驟 1：查看 Netlify Dashboard（5分鐘）

1. **登入 Netlify Dashboard**
   - https://app.netlify.com/
   - 選擇團隊：`profe-EYY`

2. **查看使用量統計**
   - 點擊團隊名稱 → **Usage**
   - 查看：
     - 構建時間使用量（Build minutes）
     - 帶寬使用量（Bandwidth）
     - 構建次數
     - 使用時間線

3. **查看構建歷史**
   - 進入項目 → **Deploys**
   - 查看這兩天有多少次構建
   - 查看每次構建花了多長時間

### 步驟 2：檢查 Git 提交歷史（2分鐘）

```bash
# 查看最近 2 天的提交
git log --since="2 days ago" --oneline

# 查看詳細提交信息
git log --since="2 days ago" --stat
```

### 步驟 3：檢查構建配置（5分鐘）

1. **檢查 Netlify 構建設置**
   - 進入項目設置 → **Build & deploy**
   - 查看：
     - 構建命令（應該為空或很短）
     - 發布目錄
     - 構建分支（應該只有 main/master）

2. **檢查 `netlify.toml`**
   - 確認已提交 `netlify.toml` 文件
   - 確認構建命令為空：`command = ""`

---

## 🛠️ 立即修復措施

### 1. 優化構建配置（已完成）

✅ 已創建 `netlify.toml` 配置文件
- 構建命令為空（靜態網站不需要構建）
- 啟用緩存減少帶寬使用

### 2. 限制構建觸發

在 Netlify Dashboard 中：
1. 進入項目設置 → **Build & deploy**
2. **只構建主分支**（main 或 master）
3. **忽略構建**：添加以下規則
   ```
   *.md
   CHANGELOG.md
   README.md
   .gitignore
   ```

### 3. 使用構建鉤子（推薦）

1. 進入項目設置 → **Build & deploy** → **Build hooks**
2. 創建構建鉤子
3. **禁用自動構建**
4. 只在需要時手動觸發構建

---

## 📋 診斷檢查清單

### 立即檢查
- [ ] 查看 Netlify Dashboard 使用量統計
- [ ] 查看構建歷史（這兩天有多少次構建）
- [ ] 查看每次構建花了多長時間
- [ ] 檢查 Git 提交歷史
- [ ] 檢查團隊中其他項目的使用情況

### 配置優化
- [ ] 提交 `netlify.toml` 配置文件
- [ ] 設置只構建主分支
- [ ] 設置忽略構建規則
- [ ] 考慮使用構建鉤子手動部署

### 聯繫支持
- [ ] 聯繫 Netlify 支持說明情況
- [ ] 請求恢復項目
- [ ] 詢問是否可以查看詳細使用量報告

---

## 💡 預期結果

### 正常情況
- **靜態網站構建時間**：通常 30 秒 - 2 分鐘
- **每月 300 分鐘**：可以構建 150-600 次
- **如果每天構建 5 次**：每月 150 次 = 剛好達到限制

### 異常情況（您的狀況）
- **如果每次構建 10 分鐘**：30 次構建 = 300 分鐘
- **如果每天構建 15 次**：2 天 = 30 次構建
- **如果構建時間 10 分鐘**：30 × 10 = 300 分鐘 ✅ 這就是問題！

---

## 🆘 如果發現問題

### 如果是構建時間過長
1. 檢查構建日誌，找出慢的原因
2. 優化構建配置
3. 移除不必要的構建步驟

### 如果是構建次數過多
1. 使用構建鉤子手動部署
2. 只構建主分支
3. 忽略不重要的文件變更

### 如果是團隊其他項目
1. 檢查所有項目的使用情況
2. 優化所有項目的構建配置
3. 考慮分離項目到不同帳號

---

## 📞 下一步

1. **立即檢查** Netlify Dashboard 使用量統計
2. **找出問題根源**（構建時間？構建次數？）
3. **應用修復措施**
4. **聯繫 Netlify 支持**請求恢復項目

---

**最後更新**：2024年

