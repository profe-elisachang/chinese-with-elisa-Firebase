# 🚨 Firebase 項目暫停 - 立即行動指南

## 📋 當前狀況
- ✅ 代碼已優化（防抖機制，減少 95-98% 寫入操作）
- ⚠️ 項目已被暫停（超過 300 信用額度）
- 🎯 目標：恢復項目並避免再次超額

---

## 🔥 立即行動（按優先順序）

### 步驟 1：檢查 Firebase Console（5分鐘）

1. **登入 Firebase Console**
   - 前往：https://console.firebase.google.com/
   - 選擇項目：`shizi-with-elisa`

2. **查看使用量統計**
   - 左側選單 → **使用量和帳單** (Usage and billing)
   - 查看：
     - 每日讀取/寫入次數
     - 哪個服務消耗最多
     - 是否有異常峰值

3. **檢查帳單狀態**
   - 查看是否產生費用
   - 確認計費週期（2月2日 - 3月1日）

---

### 步驟 2：聯繫 Firebase 支持（10分鐘）

**選項 A：通過 Firebase Console**
1. 在 Firebase Console 中，點擊右上角 **?** 或 **支援**
2. 選擇 **建立支援案例** (Create support case)
3. 說明情況：
   ```
   我的項目因為超過免費額度被暫停。我已經優化了代碼，
   將寫入操作減少了 95-98%。請協助恢復項目。
   ```

**選項 B：通過 Google Cloud Console**
1. 前往：https://console.cloud.google.com/
2. 選擇項目：`shizi-with-elisa`
3. 左側選單 → **支援** → **建立支援案例**

**選項 C：升級到 Blaze 計劃（如果急需恢復）**
- Blaze 計劃有免費配額（Spark 計劃的所有免費額度）
- 按使用量付費，但不會自動收費（需要設置預算）
- 可以立即恢復項目

---

### 步驟 3：部署優化後的代碼（15分鐘）

**如果使用 GitHub + Netlify：**

1. **提交更改**
   ```bash
   git add courses/shizi/review.html
   git add FIREBASE_OPTIMIZATION.md
   git commit -m "優化 Firebase 使用：添加防抖機制減少寫入操作"
   git push
   ```

2. **Netlify 會自動部署**
   - 檢查 Netlify 部署狀態
   - 確認新版本已上線

**如果使用其他部署方式：**
- 上傳優化後的 `review.html` 文件
- 確保新版本已部署

---

### 步驟 4：設置使用量監控（10分鐘）

1. **在 Firebase Console 中設置警報**
   - 使用量和帳單 → **預算和警報** (Budgets and alerts)
   - 創建預算警報：
     - 當使用量達到 80% 時通知
     - 當使用量達到 100% 時通知

2. **設置每日使用量限制（可選）**
   - 在 Firestore 規則中設置（需要自定義）
   - 或使用 Cloud Functions 監控

---

## 💡 長期解決方案選項

### 選項 1：繼續使用免費計劃 + 優化代碼 ✅ 推薦

**優點：**
- 完全免費
- 已優化的代碼應該足夠

**需要做的：**
- 持續監控使用量
- 如果還有問題，進一步優化代碼

**預期效果：**
- 寫入操作減少 95-98%
- 如果之前每天 10,000 次寫入 → 現在約 200-500 次
- 應該遠低於免費額度（每天 20,000 次寫入）

---

### 選項 2：升級到 Blaze 計劃（按使用量付費）

**優點：**
- 立即恢復項目
- 有免費配額（與 Spark 相同）
- 超出部分按使用量付費（很便宜）

**費用估算：**
- Firestore 寫入：每 100,000 次 = $0.18 USD
- 如果每天 500 次寫入 → 每月約 $0.03 USD（幾乎免費）

**設置預算限制：**
- 在 Google Cloud Console 設置預算警報
- 設置每月上限（如 $5 USD）
- 超過預算時自動停止服務

---

### 選項 3：實施本地存儲 + 定期同步

**實施方式：**
- 使用 IndexedDB 或 localStorage 存儲用戶進度
- 每 5-10 分鐘同步一次到 Firebase
- 或只在用戶主動點擊「保存」時同步

**優點：**
- 大幅減少 Firebase 使用量
- 離線可用

**缺點：**
- 需要更多開發工作
- 需要處理數據同步衝突

---

### 選項 4：遷移到其他數據庫

**考慮選項：**
- Supabase（有免費計劃）
- MongoDB Atlas（有免費計劃）
- 自建數據庫

**注意：**
- 需要重寫數據庫相關代碼
- 可能需要遷移現有數據

---

## 📊 使用量預估

### 優化前（估計）
- 假設每天 50 個學生，每人複習 100 張卡片
- 每次複習 = 1 次寫入
- **每天約 5,000 次寫入**
- 每月約 150,000 次寫入

### 優化後（預期）
- 使用防抖機制（3秒）
- 每次複習會話 = 1-3 次寫入（而不是 100 次）
- **每天約 150-500 次寫入**
- 每月約 4,500-15,000 次寫入
- **遠低於免費額度（每月約 600,000 次寫入）**

---

## ✅ 檢查清單

### 立即行動
- [ ] 檢查 Firebase Console 使用量統計
- [ ] 聯繫 Firebase 支持請求恢復項目
- [ ] 部署優化後的代碼
- [ ] 設置使用量警報

### 短期（1週內）
- [ ] 監控使用量，確認優化效果
- [ ] 如果還有問題，考慮進一步優化
- [ ] 考慮升級到 Blaze 計劃（如果需要）

### 長期（1個月內）
- [ ] 評估是否需要實施本地存儲
- [ ] 定期檢查使用量趨勢
- [ ] 優化其他可能的瓶頸

---

## 🆘 如果項目無法恢復

如果 Firebase 支持無法立即恢復項目，可以考慮：

1. **創建新項目**
   - 使用新的 Firebase 項目
   - 遷移數據（如果可能）
   - 部署優化後的代碼

2. **等待計費週期重置**
   - 下一個計費週期（3月2日）可能會自動恢復
   - 但需要確保代碼已優化

3. **升級到 Blaze 計劃**
   - 可以立即恢復
   - 設置預算限制避免意外費用

---

## 📞 需要幫助？

如果遇到問題，可以：
1. 查看 Firebase 文檔：https://firebase.google.com/docs
2. 聯繫 Firebase 支持
3. 檢查 Firebase 狀態頁：https://status.firebase.google.com/

---

**最後更新**：2024年（根據您的計費週期：2月2日 - 3月1日）

